<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Image Formats NG: Image Formats NG</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Image Formats NG
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Image Formats NG </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Image Formats NG project is the Next Generation of the Qt Image Formats.</p><h1>Problematic</h1>
<p>There are some problems with current image formats:</p><ul>
<li>It is not possible to read a image that contains multiple frames and mipmaps, only one-dimention arrays are supported.</li>
<li>It is not possible to write an animation or a mipmapped image.</li>
<li>It is not possible to check what options are supported in case when image can contain different subtypes (for example, dds can contain jpeg inside, which supports different compression levels, or plain data without compression)</li>
<li>Extending image formats framework is hard because of huge usage of virtual functions (it is not possible to add new virtual functions without breaking BC)</li>
</ul>
<h1>Basic reading</h1>
<p>Basically, you used QImageReader to read an image from the file.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;QImageReader&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;QDebug&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> handleImage(<span class="keyword">const</span> QImage &amp;image);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    QImageReader reader(<span class="stringliteral">&quot;image.png&quot;</span>);</div><div class="line">    QImage image = reader.<a class="code" href="class_image_i_o.html#a367e297536512e980b71a4852723feb6">read</a>();</div><div class="line">    <span class="keywordflow">if</span> (image.isNull()) {</div><div class="line">        qWarning() &lt;&lt; <span class="stringliteral">&quot;Error reading image&quot;</span> &lt;&lt; reader.errorString();</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    handleImage(image);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p> Now, you should use an <a class="el" href="class_image_i_o.html" title="Basic Image unput/output. ">ImageIO</a> class instead.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ImageIO&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;QDebug&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> handleImage(<span class="keyword">const</span> QImage &amp;image);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <a class="code" href="class_image_i_o.html">ImageIO</a> reader(<span class="stringliteral">&quot;image.png&quot;</span>);</div><div class="line">    <span class="keyword">auto</span> result = reader.<a class="code" href="class_image_i_o.html#a367e297536512e980b71a4852723feb6">read</a>();</div><div class="line">    <a class="code" href="class_image_i_o_result.html">ImageIOResult</a> ok = result.first;</div><div class="line">    <span class="keywordflow">if</span> (!ok) {</div><div class="line">        qWarning() &lt;&lt; <span class="stringliteral">&quot;Error reading image:&quot;</span> &lt;&lt; ok.<a class="code" href="class_image_i_o_result.html#ad1787f2bd709a418e96276ccaf6b7969">toString</a>();</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    <a class="code" href="class_image_contents.html">ImageContents</a> contents = result.second;</div><div class="line">    handleImage(contents.image());</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> <h1>Basic writing</h1>
<p>Simple writing is done almost the same way as with QImageWriter.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ImageIO&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;QDebug&gt;</span></div><div class="line"></div><div class="line">QImage createImage();</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    QImage image = createImage();</div><div class="line">    <a class="code" href="class_image_i_o.html">ImageIO</a> writer(<span class="stringliteral">&quot;image.png&quot;</span>);</div><div class="line">    <a class="code" href="class_image_contents.html">ImageContents</a> contents(image);</div><div class="line">    <a class="code" href="class_image_i_o_result.html">ImageIOResult</a> ok = writer.write(contents);</div><div class="line">    <span class="keywordflow">if</span> (!ok) {</div><div class="line">        qWarning() &lt;&lt; <span class="stringliteral">&quot;Error writing image:&quot;</span> &lt;&lt; ok.<a class="code" href="class_image_i_o_result.html#ad1787f2bd709a418e96276ccaf6b7969">toString</a>();</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> <h1>Reading image meta data</h1>
<p>It is possible to read image meta data without reading the whole contents of the file.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ImageIO&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;QDebug&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <a class="code" href="class_image_i_o.html">ImageIO</a> reader(<span class="stringliteral">&quot;image.png&quot;</span>);</div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> result = reader.<a class="code" href="class_image_i_o.html#a53ec4c6b26a695bf3751866881bbac6a">readHeader</a>();</div><div class="line">    <span class="keywordflow">if</span> (!result.first) {</div><div class="line">        qWarning() &lt;&lt; <span class="stringliteral">&quot;Error reading header:&quot;</span> &lt;&lt; result.first.toString();</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    <a class="code" href="class_image_header.html">ImageHeader</a> header = result.second;</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;size = &quot;</span> &lt;&lt; header.<a class="code" href="class_image_header.html#a77349e9948b69419a3c449cffaa5b513">size</a>();</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;format = &quot;</span> &lt;&lt; header.<a class="code" href="class_image_header.html#a46bde23d6ac2eeef0bf57c4849811653">imageFormat</a>();</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;image count = &quot;</span> &lt;&lt; header.<a class="code" href="class_image_header.html#ab59750873f29f284b5d11913fdfd8478">imageCount</a>();</div><div class="line">    qDebug() &lt;&lt; <span class="stringliteral">&quot;mipmap count = &quot;</span> &lt;&lt; header.<a class="code" href="class_image_header.html#aa20617b07a5bd0d6f68685971161a3e3">mipmapCount</a>();</div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> contentsResult = reader.<a class="code" href="class_image_i_o.html#afe52c6dbbeaa2ee369cfd7c30b41f80d">readContents</a>(header);</div><div class="line">    <span class="comment">// if (!contentsResult.first) ...</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> <h1>Complex reading</h1>
<p>Image Formats NG supports rather complex data structures. First, there can be one of three types of images - a simple 1d/2d image, represented by a QImage, a 6-sided cubemap, represented by <a class="el" href="class_cube_texture.html" title="CubeTexture class represents a 6 sided cubic texture. ">CubeTexture</a> and a 3d texture, represented by <a class="el" href="class_volume_texture.html" title="VolumeTexture class represents a 3D dimentional image. ">VolumeTexture</a>. Second, there can be multiple 'frames' (for example, GIF file is an array of images). Third, each frame can have prescaled images of different sizes, i.e. mipmaps (for example, icns is a single image with mipmaps).</p>
<p>The most complex file can be read as follows. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ImageIO&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;QDebug&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <a class="code" href="class_image_i_o.html">ImageIO</a> reader(<span class="stringliteral">&quot;texture.dds&quot;</span>);</div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> result = reader.<a class="code" href="class_image_i_o.html#a367e297536512e980b71a4852723feb6">read</a>();</div><div class="line"></div><div class="line">    <span class="comment">// if (!result.first) ...</span></div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;contents = result.second;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; contents.<a class="code" href="class_image_contents.html#a8f1f2bd316bc2f60a7d1d7d9131bef11">header</a>().<a class="code" href="class_image_header.html#ab59750873f29f284b5d11913fdfd8478">imageCount</a>(); ++index) { <span class="comment">// read array</span></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; contents.<a class="code" href="class_image_contents.html#a8f1f2bd316bc2f60a7d1d7d9131bef11">header</a>().<a class="code" href="class_image_header.html#aa20617b07a5bd0d6f68685971161a3e3">mipmapCount</a>(); ++level) { <span class="comment">// read mipmaps</span></div><div class="line">            <a class="code" href="class_image_resource.html">ImageResource</a> resource = contents.<a class="code" href="class_image_contents.html#afb895fbebf18bfd32616134843c3126c">resource</a>(index, level);</div><div class="line">            <span class="keywordflow">if</span> (resource.<a class="code" href="class_image_resource.html#a977979a893a4846b5aed182d551f9ab0">type</a>() == <a class="code" href="class_image_resource.html#a9dfb7213bbb250d8396a62c5b10561b7abe53a0541a6d36f6ecb879fa2c584b08">ImageResource::Type::Image</a>) {</div><div class="line">                <span class="keyword">const</span> QImage image = resource.<a class="code" href="class_image_resource.html#a6782468ec9f0e2decc8aeb0ee13e78e0">image</a>();</div><div class="line">                <span class="comment">// ...</span></div><div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (resource.<a class="code" href="class_image_resource.html#a977979a893a4846b5aed182d551f9ab0">type</a>() == <a class="code" href="class_image_resource.html#a9dfb7213bbb250d8396a62c5b10561b7a78c5d04c3ca69a3d97185e00779ced77">ImageResource::Type::CubeTexture</a>) {</div><div class="line">                <a class="code" href="class_cube_texture.html">CubeTexture</a> texture = resource.<a class="code" href="class_image_resource.html#ac79e72034b34f61b57dc9644fec8f068">cubeTexture</a>();</div><div class="line">                <span class="comment">// ...</span></div><div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (resource.<a class="code" href="class_image_resource.html#a977979a893a4846b5aed182d551f9ab0">type</a>() == <a class="code" href="class_image_resource.html#a9dfb7213bbb250d8396a62c5b10561b7aa46c96eca05928413b7b5bd3e81e4eae">ImageResource::Type::VolumeTexture</a>) {</div><div class="line">                <a class="code" href="class_volume_texture.html">VolumeTexture</a> texture = resource.<a class="code" href="class_image_resource.html#ade224afee2dfa6cf0a91e9d43d27a44a">volumeTexture</a>();</div><div class="line">                <span class="comment">// ...</span></div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="class_image_exif_meta.html">ImageExifMeta</a> exif = contents.<a class="code" href="class_image_contents.html#a543ea8f1de92b69955a94b9039682455">exifMeta</a>();</div><div class="line">    <span class="keywordflow">if</span> (!exif.<a class="code" href="class_image_exif_meta.html#afe501ee6ac4481d9fd5a68721bd36a04">isEmpty</a>()) {</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --></div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 18 2017 23:05:28 for Image Formats NG by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
